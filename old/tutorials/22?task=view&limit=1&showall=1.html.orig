<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb">

<head>
  <base href="http://jlleblanc.com/tutorials/22" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="robots" content="index, follow" />
  <meta name="keywords" content="joomla, Joomla" />
  <meta name="title" content="Daily Message with E-mail" />
  <meta name="author" content="" />
  <meta name="description" content="i like code." />
  <meta name="generator" content="Joomla! 1.5 - Open Source Content Management" />
  <title>Daily Message with E-mail</title>
  <link href="/templates/blueprint/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script type="text/javascript" src="/media/system/js/mootools.js"></script>
  <script type="text/javascript" src="/media/system/js/caption.js"></script>


<link rel="stylesheet" href="/templates/blueprint/css/blueprint/screen.css" type="text/css" media="screen, projection" />
<link rel="stylesheet" href="/templates/blueprint/css/blueprint/print.css" type="text/css" media="print" />
<!--[if lt IE 8]>
  <link rel="stylesheet" href="/templates/blueprint/css/blueprint/ie.css" type="text/css" media="screen, projection">
<![endif]-->
<link rel="stylesheet" href="/templates/blueprint/css/template.css" type="text/css" media="screen" />

<link rel="stylesheet" href="/templates/blueprint/dailymessage/dailymessage.css" type="text/css" media="screen" />
<script language="javascript" type="text/javascript" src="/templates/blueprint/dailymessage/jquery-latest.pack.js"></script>
<script type="text/javascript" charset="utf-8">
	jQuery.noConflict();
</script>
<script language="javascript" type="text/javascript" src="/templates/blueprint/dailymessage/dailymessage.js"></script>
</head>

<body>
	<div class="container" id="top_module">
		
	</div>
	<div id="logo"><img src="/templates/blueprint/img/jlleblanc.png" /></div>
	<div class="container">
		<div class="column span-6">
					<div class="moduletable_menu">
					<ul class="menu"><li class="item71"><a href="http://jlleblanc.com/"><span>home</span></a></li><li class="item51"><a href="/joomla"><span>joomla</span></a></li><li class="item61"><a href="http://www.designvsdevelop.com"><span>blog</span></a></li><li class="item75"><a href="http://www.extool.org"><span>extool</span></a></li><li class="item72"><a href="/ministries"><span>ministries</span></a></li></ul>		</div>
			<div class="moduletable">
					<h3>Joomla Resources</h3>
					<ul class="menu"><li class="item52"><a href="/articles"><span>articles</span></a></li><li id="current" class="active item54"><a href="/tutorials"><span>tutorials</span></a></li><li class="item73"><a href="/podcast-suite"><span>podcast suite</span></a></li><li class="item76"><a href="/joomladay-giveaway"><span>joomladay giveaway</span></a></li></ul>		</div>
	
		</div>
		<div class="column last span-18">
			
<div id="page">



<h2 class="contentheading">
	Daily Message with E-mail</h2>



<p class="buttonheading">
	</p>





	<table cellpadding="0" cellspacing="0" class="contenttoc">
	<tr>
		<th>Article Index</th>
	</tr>
	
	<tr>
		<td>
		<a href="/tutorials/22?task=view&amp;limit=1" class="toclink">Daily Message with E-mail</a>
		</td>
	</tr>
	
			<tr>
				<td>
				<a href="/tutorials/22?task=view&amp;limit=1&amp;start=1" class="toclink">Page 2</a>
				</td>
			</tr>
			
			<tr>
				<td>
				<a href="/tutorials/22?task=view&amp;limit=1&amp;start=2" class="toclink">Page 3</a>
				</td>
			</tr>
			
		<tr>
			<td>
				<a href="/tutorials/22?task=view&amp;limit=1&amp;showall=1" class="toclink active">All Pages</a>
			</td>
		</tr>
		</table>
You can easily give your visitors the ability to send their friends Daily Messages through e-mail. Using the mosMail() function, you ensure the appropriate settings are in place and do not have to wrestle with message headers. You can also place this in a styled pop-up window without loading the full template.<br /><br />Since we are adding many more features to the frontend, it makes sense to move some of the code from dailymessage.php to dailymessage.html.php. This allows us to keep most of the logic in dailymessage.php, while handling the presentation through dailymessage.html.php.<br /><br />This tutorial is designed to work with Mambo 4.5.1 and later. A downloadable copy of the tutorial is available <a href="/com_dailymessage_email.zip">here</a>.<br /><br />Use the page navigation at the bottom, or use these links to jump directly to a file:<br /><br /><a href="/tutorials/22?task=view&amp;limit=1&amp;start=1">dailymessage.php</a><br /><a href="/tutorials/22?task=view&amp;limit=1&amp;start=2">dailymessage.html.php</a><br /><br /><br/><br /><h1><span style="font-weight: bold;"></span>dailymessage.php</h1><span style="color: rgb(0, 0, 255);">&lt;?</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">defined( '_VALID_MOS' ) or die( 'Direct Access to this location is not allowed.' );</span><br /><br />If someone tries to request this file outside of Mambo, stop them right here.<br /><br /><span style="color: rgb(0, 153, 0);">require_once ( $mainframe-&gt;getPath( 'front_html' ) );</span><br /><br />For this version of Daily Message, the file dailymessage.html.php has been added. Except for the e-mail function, all of the output is now handled through this file, making it easier for other developers to make quick formatting modifications.<br /><br /><span style="color: rgb(0, 153, 0);">$id = mosGetParam($_REQUEST, 'id', '');</span><br /><br />This version allows the user to select one Daily Message to e-mail to friends. To accomodate this, links generated by the component pass an ID number for future reference. If no message is selected, $id is set to null.<br /><br /><span style="color: rgb(0, 153, 0);">switch( $task )</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; case &quot;sendemail&quot;:</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; SendEmail($option, $id);</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; break;</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; case &quot;emailform&quot;:</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; EmailForm($option, $id);</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; break;</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; default:</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; ListMessages($option);</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; break;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">}</span><br /><br />From here, the function to call is determined by the $task variable, which is extracted either from a link or a form POST. The &quot;sendmail&quot; task is placed in a variable on the form where e-mail addresses are entered. Links to pop-up windows contain a value of &quot;emailform&quot;. If the 'task' variable is not set (for instance, when the component is first loaded by a visitor), a screen containing all of the currently published Daily Messages appears.<br /><br /><br /><span style="color: rgb(0, 153, 0);">function SendEmail($option, $id)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; global $database;</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $sendername = mosGetParam($_REQUEST, 'sendername', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $emailfrom = mosGetParam($_REQUEST, 'emailfrom', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $emailto = mosGetParam($_REQUEST, 'emailto', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $note = mosGetParam($_REQUEST, 'note', '');</span><br /><br />The variables 'sendername', 'emailform', 'emailto', and 'note' are pulled from the current HTTP request. This will allow for some simple error checking.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; if(!$sendername || !$emailfrom || !$emailto)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; {</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; dailymessage_HTML::FillAllFields();</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; EmailForm($option, $id);</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; }</span><br style="color: rgb(102, 204, 0);" /><br />To send a proper e-mail, three things are essential: a name, an email address to &quot;send from&quot;, and a destination address. When any of these are missing, the visitor is given an alert and the form is loaded again. The &quot;return;&quot; call ensures that the rest of this function is not processed, as the data necessary for the e-mail is not ready.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $subject = &quot;A message you may find interesting&quot;;</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; if($note)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; {</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $message = $note . &quot;\n\n&quot;;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; } else {</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $message = &quot;$sendername thought you might find this message interesting.\n\n&quot;;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; }</span><br /><br />When a sender, an e-mail address to send from, and a recipient are present, a message can be put together. To keep the mosMail call simple, the various elements are held in string variables. First, a friendly and appropriate subject is set. Next, the $note variable is checked for a custom message from the visitor. If one has been entered, this is put into the message body. Otherwise, a straightforward, generic introduction containing the visitor's name starts off the e-mail.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $database-&gt;SetQuery(&quot;SELECT * FROM #__joe_dailymessage WHERE id = '&quot; . $id . &quot;'&quot;);</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $rows = $database-&gt;loadObjectList();</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $row = $rows[0];</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $message .= $row-&gt;message . &quot; &quot; . mosFormatDate($row-&gt;date);</span><br /><br />To send a Daily Message to the visitor's friend, it is pulled from the database. A query containing the passed ID is built and executed. The first row of the set is loaded (there should only be one). The contents of the Daily Message gets added to the body along with the date, formatted according to the site settings.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; mosMail($emailfrom, $sendername, $emailto, $subject, $message);</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; dailymessage_HTML::Success();</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">}</span><br /><br />Finally, the message is sent to the recipient. The first parameter of mosMail is the address of the visitor, the second is the visitor's name, third is the destination address, fourth is the subject, and the e-mail body is fifth. After sending the message, a success message is displayed.<br /><br /><br /><span style="color: rgb(0, 153, 0);">function EmailForm($option, $id)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $sendername = mosGetParam($_REQUEST, 'sendername', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $emailfrom = mosGetParam($_REQUEST, 'emailfrom', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $emailto = mosGetParam($_REQUEST, 'emailto', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $note = mosGetParam($_REQUEST, 'note', '');</span><br /><br />The EmailForm() function is called when the form for entering e-mail addresses is to be displayed. If the form is reloading (when there is an error, for instance), the submitted variables are extracted from the request and put back into the form. This eliminates retyping which makes visitors much happier.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; dailymessage_HTML::EmailForm($option, $id, $sendername, $emailfrom, $emailto, $note);</span><br /><br />Once the variables are ready, the form is drawn prefilled with any submitted information.<br /><br /><span style="color: rgb(0, 153, 0);">}</span><br /><br /><br /><span style="color: rgb(0, 153, 0);">function ListMessages ($option)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br /><br /><span style="color: rgb(0, 0, 255);">global $database;</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">// get configuration information</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$database-&gt;setQuery(&quot;SELECT * FROM #__joe_dailymessage_conf LIMIT 1&quot;);</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$rows = $database-&gt;loadObjectList();</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$row = $rows[0];</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$bold = $row-&gt;bold;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$italic = $row-&gt;italic;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$underline = $row-&gt;underline;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$showdate = $row-&gt;showdate;</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$starttags = &quot;&quot;;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$endtags = &quot;&quot;;</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">if($bold == 1)</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">{</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $starttags .= &quot;&lt;b&gt;&quot;;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $endtags = &quot;&lt;/b&gt;&quot; . $endtags;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">}</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">if($italic == 1)</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">{</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $starttags .= &quot;&lt;i&gt;&quot;;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $endtags = &quot;&lt;/i&gt;&quot; . $endtags;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">}</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">if($underline == 1)</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">{</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $starttags .= &quot;&lt;u&gt;&quot;;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $endtags = &quot;&lt;/u&gt;&quot; . $endtags;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">}</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">//get data and output accordingly</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$database-&gt;setQuery(&quot;SELECT * FROM #__joe_dailymessage WHERE published = '1'&quot;);</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$rows = $database-&gt;loadObjectList();</span><br /><br /><br /><span style="color: rgb(51, 153, 0);">dailymessage_HTML::ListMessages ($option, $bold, $italic, $underline, $showdate, $starttags, $endtags, $rows);</span><br /><br />Except for this last line, the contents of this function match with the original dailymessage.php file. The rest of the output code is in the new dailymessage.html.php file and has been modified to accommodate the pop-up window links.<br /><br /><span style="color: rgb(51, 153, 0);">}</span><br /><br />?&gt;<br /><br /><br/><br /><h1>dailymessage.html.php</h1>&lt;?<br /><br /><span style="color: rgb(0, 153, 0);">defined( '_VALID_MOS' ) or die( 'Direct Access to this location is not allowed.' );</span><br /><br />Access outside of Mambo is disallowed here.<br /><br /><span style="color: rgb(0, 153, 0);">class dailymessage_HTML {</span><br /><br />This class contains a series of functions handling the component's output. Queries have been avoided and variables are passed instead. <br /><br /><span style="color: rgb(0, 153, 0);">function FillAllFields()</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; ?&gt;&lt;center&gt;&lt;font color=&quot;#FF0000&quot;&gt;Please fill in all of the fields.&lt;/font&gt;&lt;/center&gt;&lt;?</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">}</span><br /><br />FillAllFields displays a message when the visitor has not given enough information to send a mailing.<br /><br /><br /><span style="color: rgb(0, 153, 0);">function Success()</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; ?&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;center&gt;&lt;b&gt;Message sent successfully.&lt;/b&gt;&lt;BR&gt;&lt;BR&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Close&quot; class=&quot;button&quot; onClick=&quot;{window.close();}&quot;&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/center&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &lt;?</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">} </span><br /><br />Once an e-mail has been successfully sent, this function displays the success message and provides a button for closing the window.<br /><br /><br /><span style="color: rgb(0, 153, 0);">function EmailForm($option, $id, $sendername, $emailfrom, $emailto, $note)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ?&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;form action=&quot;index2.php&quot; method=&quot;post&quot;&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;table&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;tr&gt;&lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;Send this message&lt;/td&gt;&lt;/tr&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;tr&gt;&lt;td align=&quot;left&quot;&gt;Your Name:&lt;/td&gt; &lt;td&gt;&lt;input name=&quot;sendername&quot; value=&quot;&lt;? echo $sendername; ?&gt;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;tr&gt;&lt;td align=&quot;left&quot;&gt;Your e-mail:&lt;/td&gt; &lt;td&gt;&lt;input name=&quot;emailfrom&quot; value=&quot;&lt;? echo $emailfrom; ?&gt;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;tr&gt;&lt;td align=&quot;left&quot;&gt;Your friend's e-mail:&lt;/td&gt; &lt;td&gt;&lt;input name=&quot;emailto&quot; value=&quot;&lt;? echo $emailto; </span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">?&gt;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;tr&gt;&lt;td align=&quot;left&quot;&gt;An additional note (optional):&lt;/td&gt; &lt;td&gt;&lt;textarea name=&quot;note&quot; rows=&quot;5&quot; cols=&quot;30&quot;&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&lt;? echo $note; ?&gt;&lt;/textarea&gt;&lt;/td&gt;&lt;/tr&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;tr&gt;&lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;Send Message&quot; class=&quot;button&quot;&gt;&nbsp;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&lt;input type=&quot;button&quot; value=&quot;Cancel&quot; class=&quot;button&quot; onClick=&quot;{window.close();}&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/table&gt;</span><br /><br />Fields on this form are populated by previously entered values, when present. If the visitor omits an essential value, repeated data entry will not be necessary. Submit and Cancel buttons are also generated.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;? echo $id; ?&gt;&quot;&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;hidden&quot; name=&quot;task&quot; value=&quot;sendemail&quot;&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;hidden&quot; name=&quot;option&quot; value=&quot;&lt;? echo $option; ?&gt;&quot;&gt;</span><br /><br />The 'option' variable tells Mambo which component to load, while 'task' is used within dailymessage.php. To ensure the correct Daily Message loads the correct message, the 'id' variable is set to the appropriate database row number.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/form&gt;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;?</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">} </span><br /><br /><br /><span style="color: rgb(0, 153, 0);">function ListMessages($option, $bold, $italic, $underline, $showdate, $starttags, $endtags, &amp;$rows)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 0, 255);">?&gt;&lt;table&gt;&lt;?</span><br /><br /><br /><span style="color: rgb(0, 0, 255);">foreach($rows as $row)</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">{</span><br /><span style="color: rgb(0, 102, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $button = &quot;&lt;a href=\&quot;#\&quot; onClick=\&quot;javascript:{ window.open('index2.php?option=$option&amp;task=emailform&amp;id=&quot; . $row-&gt;id . &quot;', 'emailform', 'height=350,width=400'); }\&quot;&gt;&lt;img src=\&quot;images/M_images/emailButton.png\&quot; border=\&quot;0\&quot;&gt;&lt;/a&gt;&quot;;</span><br /><br />Although most of the code for this function has been copied directly out of the original dailymessage.php file, the &quot;email-a-friend&quot; link is new. The code is set to open a pop-up window and load the current component, but using the index2.php file. Instead of loading a fully-featured page with modules, index2.php loads the CSS file for the current template, then loads the component output. This allows for a consistent look and feel, while providing space within a visually small area. The image used is part of a standard Mambo installation.<br /><br /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if($showdate == 1)</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;&lt;tr&gt;&lt;td&gt;&quot; . mosFormatDate($row-&gt;date) . &quot;&lt;/td&gt;&quot;;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; else</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;&lt;tr&gt;&quot;;</span><br /><br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 0, 255);">echo &quot;&lt;td&gt;&quot; . $starttags . $row-&gt;message . $endtags .</span> <span style="color: rgb(0, 102, 0);">&quot;&nbsp;&quot; . $button . </span><span style="color: rgb(0, 0, 255);">&quot;&lt;/td&gt;&lt;/tr&gt;&quot;;</span><br /><br />This portion of code is identical to the original location in dailymessage.php, except that a forced space and the e-mail button have been added.<br /><br /><span style="color: rgb(0, 102, 0);">}</span><br style="color: rgb(0, 102, 0);" /><br style="color: rgb(0, 102, 0);" /><span style="color: rgb(0, 102, 0);">?&gt;&lt;/table&gt;&lt;?</span><br /><br />} <br /><br />} // class dailymessage_HTML<br /><br />?&gt;<br /><br />Download a copy of the new component <a href="/com_dailymessage_email.zip">here</a>. This will not interfere with any of the other Daily Message tutorials.<br />

</div>

		</div>
	</div>
	<div class="container">
		
	</div>
</body>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2258922-1";
urchinTracker();
</script>
</html>
