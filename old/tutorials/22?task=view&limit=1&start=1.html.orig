<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb">

<head>
  <base href="http://jlleblanc.com/tutorials/22" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="robots" content="index, follow" />
  <meta name="keywords" content="joomla, Joomla" />
  <meta name="title" content="Daily Message with E-mail - Page 2" />
  <meta name="author" content="" />
  <meta name="description" content="i like code." />
  <meta name="generator" content="Joomla! 1.5 - Open Source Content Management" />
  <title>Daily Message with E-mail - Page 2</title>
  <link href="/templates/blueprint/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script type="text/javascript" src="/media/system/js/mootools.js"></script>
  <script type="text/javascript" src="/media/system/js/caption.js"></script>


<link rel="stylesheet" href="/templates/blueprint/css/blueprint/screen.css" type="text/css" media="screen, projection" />
<link rel="stylesheet" href="/templates/blueprint/css/blueprint/print.css" type="text/css" media="print" />
<!--[if lt IE 8]>
  <link rel="stylesheet" href="/old/media/ie.css" type="text/css" media="screen, projection">
<![endif]-->
<link rel="stylesheet" href="/templates/blueprint/css/template.css" type="text/css" media="screen" />

<link rel="stylesheet" href="/templates/blueprint/dailymessage/dailymessage.css" type="text/css" media="screen" />
<script language="javascript" type="text/javascript" src="/templates/blueprint/dailymessage/jquery-latest.pack.js"></script>
<script type="text/javascript" charset="utf-8">
	jQuery.noConflict();
</script>
<script language="javascript" type="text/javascript" src="/templates/blueprint/dailymessage/dailymessage.js"></script>
</head>

<body>
	<div class="container" id="top_module">

	</div>
	<div id="logo"><img src="/templates/blueprint/img/jlleblanc.png" /></div>
	<div class="container">
		<div class="column span-6">
					<div class="moduletable_menu">
					<ul class="menu"><li class="item71"><a href="http://jlleblanc.com/"><span>home</span></a></li><li class="item51"><a href="/joomla"><span>joomla</span></a></li><li class="item61"><a href="http://www.designvsdevelop.com"><span>blog</span></a></li><li class="item75"><a href="http://www.extool.org"><span>extool</span></a></li><li class="item72"><a href="/ministries"><span>ministries</span></a></li></ul>		</div>
			<div class="moduletable">
					<h3>Joomla Resources</h3>
					<ul class="menu"><li class="item52"><a href="/articles"><span>articles</span></a></li><li id="current" class="active item54"><a href="/tutorials"><span>tutorials</span></a></li><li class="item73"><a href="/podcast-suite"><span>podcast suite</span></a></li><li class="item76"><a href="/joomladay-giveaway"><span>joomladay giveaway</span></a></li></ul>		</div>

		</div>
		<div class="column last span-18">

<div id="page">



<h2 class="contentheading">
	Daily Message with E-mail - Page 2</h2>



<p class="buttonheading">
	</p>





	<table cellpadding="0" cellspacing="0" class="contenttoc">
	<tr>
		<th>Article Index</th>
	</tr>

	<tr>
		<td>
		<a href="/tutorials/22?task=view&amp;limit=1" class="toclink">Daily Message with E-mail</a>
		</td>
	</tr>

			<tr>
				<td>
				<a href="/tutorials/22?task=view&amp;limit=1&amp;start=1" class="toclink active">Page 2</a>
				</td>
			</tr>

			<tr>
				<td>
				<a href="/tutorials/22?task=view&amp;limit=1&amp;start=2" class="toclink">Page 3</a>
				</td>
			</tr>

		<tr>
			<td>
				<a href="/tutorials/22?task=view&amp;limit=1&amp;showall=1" class="toclink">All Pages</a>
			</td>
		</tr>
		</table>
<div class="pagenavcounter">Page 2 of 3</div><br /><h1><span style="font-weight: bold;"></span>dailymessage.php</h1><span style="color: rgb(0, 0, 255);">&lt;?</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">defined( '_VALID_MOS' ) or die( 'Direct Access to this location is not allowed.' );</span><br /><br />If someone tries to request this file outside of Mambo, stop them right here.<br /><br /><span style="color: rgb(0, 153, 0);">require_once ( $mainframe-&gt;getPath( 'front_html' ) );</span><br /><br />For this version of Daily Message, the file dailymessage.html.php has been added. Except for the e-mail function, all of the output is now handled through this file, making it easier for other developers to make quick formatting modifications.<br /><br /><span style="color: rgb(0, 153, 0);">$id = mosGetParam($_REQUEST, 'id', '');</span><br /><br />This version allows the user to select one Daily Message to e-mail to friends. To accomodate this, links generated by the component pass an ID number for future reference. If no message is selected, $id is set to null.<br /><br /><span style="color: rgb(0, 153, 0);">switch( $task )</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; case &quot;sendemail&quot;:</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; SendEmail($option, $id);</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; break;</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; case &quot;emailform&quot;:</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; EmailForm($option, $id);</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; break;</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; default:</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; ListMessages($option);</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; break;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">}</span><br /><br />From here, the function to call is determined by the $task variable, which is extracted either from a link or a form POST. The &quot;sendmail&quot; task is placed in a variable on the form where e-mail addresses are entered. Links to pop-up windows contain a value of &quot;emailform&quot;. If the 'task' variable is not set (for instance, when the component is first loaded by a visitor), a screen containing all of the currently published Daily Messages appears.<br /><br /><br /><span style="color: rgb(0, 153, 0);">function SendEmail($option, $id)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; global $database;</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $sendername = mosGetParam($_REQUEST, 'sendername', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $emailfrom = mosGetParam($_REQUEST, 'emailfrom', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $emailto = mosGetParam($_REQUEST, 'emailto', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $note = mosGetParam($_REQUEST, 'note', '');</span><br /><br />The variables 'sendername', 'emailform', 'emailto', and 'note' are pulled from the current HTTP request. This will allow for some simple error checking.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; if(!$sendername || !$emailfrom || !$emailto)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; {</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; dailymessage_HTML::FillAllFields();</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; EmailForm($option, $id);</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; return;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; }</span><br style="color: rgb(102, 204, 0);" /><br />To send a proper e-mail, three things are essential: a name, an email address to &quot;send from&quot;, and a destination address. When any of these are missing, the visitor is given an alert and the form is loaded again. The &quot;return;&quot; call ensures that the rest of this function is not processed, as the data necessary for the e-mail is not ready.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $subject = &quot;A message you may find interesting&quot;;</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; if($note)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; {</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $message = $note . &quot;\n\n&quot;;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; } else {</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $message = &quot;$sendername thought you might find this message interesting.\n\n&quot;;</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; }</span><br /><br />When a sender, an e-mail address to send from, and a recipient are present, a message can be put together. To keep the mosMail call simple, the various elements are held in string variables. First, a friendly and appropriate subject is set. Next, the $note variable is checked for a custom message from the visitor. If one has been entered, this is put into the message body. Otherwise, a straightforward, generic introduction containing the visitor's name starts off the e-mail.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $database-&gt;SetQuery(&quot;SELECT * FROM #__joe_dailymessage WHERE id = '&quot; . $id . &quot;'&quot;);</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $rows = $database-&gt;loadObjectList();</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $row = $rows[0];</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; $message .= $row-&gt;message . &quot; &quot; . mosFormatDate($row-&gt;date);</span><br /><br />To send a Daily Message to the visitor's friend, it is pulled from the database. A query containing the passed ID is built and executed. The first row of the set is loaded (there should only be one). The contents of the Daily Message gets added to the body along with the date, formatted according to the site settings.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; mosMail($emailfrom, $sendername, $emailto, $subject, $message);</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; dailymessage_HTML::Success();</span><br style="color: rgb(0, 153, 0);" /><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">}</span><br /><br />Finally, the message is sent to the recipient. The first parameter of mosMail is the address of the visitor, the second is the visitor's name, third is the destination address, fourth is the subject, and the e-mail body is fifth. After sending the message, a success message is displayed.<br /><br /><br /><span style="color: rgb(0, 153, 0);">function EmailForm($option, $id)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $sendername = mosGetParam($_REQUEST, 'sendername', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $emailfrom = mosGetParam($_REQUEST, 'emailfrom', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $emailto = mosGetParam($_REQUEST, 'emailto', '');</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $note = mosGetParam($_REQUEST, 'note', '');</span><br /><br />The EmailForm() function is called when the form for entering e-mail addresses is to be displayed. If the form is reloading (when there is an error, for instance), the submitted variables are extracted from the request and put back into the form. This eliminates retyping which makes visitors much happier.<br /><br /><span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; dailymessage_HTML::EmailForm($option, $id, $sendername, $emailfrom, $emailto, $note);</span><br /><br />Once the variables are ready, the form is drawn prefilled with any submitted information.<br /><br /><span style="color: rgb(0, 153, 0);">}</span><br /><br /><br /><span style="color: rgb(0, 153, 0);">function ListMessages ($option)</span><br style="color: rgb(0, 153, 0);" /><span style="color: rgb(0, 153, 0);">{</span><br /><br /><span style="color: rgb(0, 0, 255);">global $database;</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">// get configuration information</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$database-&gt;setQuery(&quot;SELECT * FROM #__joe_dailymessage_conf LIMIT 1&quot;);</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$rows = $database-&gt;loadObjectList();</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$row = $rows[0];</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$bold = $row-&gt;bold;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$italic = $row-&gt;italic;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$underline = $row-&gt;underline;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$showdate = $row-&gt;showdate;</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$starttags = &quot;&quot;;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$endtags = &quot;&quot;;</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">if($bold == 1)</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">{</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $starttags .= &quot;&lt;b&gt;&quot;;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $endtags = &quot;&lt;/b&gt;&quot; . $endtags;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">}</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">if($italic == 1)</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">{</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $starttags .= &quot;&lt;i&gt;&quot;;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $endtags = &quot;&lt;/i&gt;&quot; . $endtags;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">}</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">if($underline == 1)</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">{</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $starttags .= &quot;&lt;u&gt;&quot;;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; $endtags = &quot;&lt;/u&gt;&quot; . $endtags;</span><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">}</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">//get data and output accordingly</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$database-&gt;setQuery(&quot;SELECT * FROM #__joe_dailymessage WHERE published = '1'&quot;);</span><br style="color: rgb(0, 0, 255);" /><br style="color: rgb(0, 0, 255);" /><span style="color: rgb(0, 0, 255);">$rows = $database-&gt;loadObjectList();</span><br /><br /><br /><span style="color: rgb(51, 153, 0);">dailymessage_HTML::ListMessages ($option, $bold, $italic, $underline, $showdate, $starttags, $endtags, $rows);</span><br /><br />Except for this last line, the contents of this function match with the original dailymessage.php file. The rest of the output code is in the new dailymessage.html.php file and has been modified to accommodate the pop-up window links.<br /><br /><span style="color: rgb(51, 153, 0);">}</span><br /><br />?&gt;<br /><br /><br /><div class="pagenavbar"><div><a href="/tutorials/22?task=view&amp;limit=1">&lt;&lt; Prev</a> - <a href="/tutorials/22?task=view&amp;limit=1&amp;start=2">Next &gt;&gt;</a></div></div><br />

</div>

		</div>
	</div>
	<div class="container">

	</div>
</body>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2258922-1";
urchinTracker();
</script>
</html>
